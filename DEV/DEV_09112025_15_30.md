# DEV - Session du 09/11/2025 15:30

## D√©but de session

- Date : 09/11/2025
- Heure : 15:30
- Contexte : Nouvelle session de d√©veloppement
- Projet : ACLEF P√©dagogique

---

## Notes de session

---

## [2025-11-10 03:45] - Feature: Mode Karaok√© dans Construis des phrases + Corrections navigation

### Fichiers modifi√©s
- `pages/lire/construis-phrases/tranquille.js` - Ajout mode karaok√© avec lecture s√©quentielle
- `pages/lire/construis-phrases/index.js` - Stockage texte_ids + navigation corrig√©e
- `pages/lire/construis-phrases/difficile.js` - Navigation corrig√©e
- `pages/lire/construis-phrases/defi.js` - Navigation corrig√©e
- `pages/lire/reconnaitre-les-mots.js` - Passage texte_ids dans URL vers construis-phrases

### Points cl√©s √† retenir
- **Mode karaok√©** : Lecture s√©quentielle avec illumination jaune des mots (#fef08a)
  - D√©clenchement : Bouton "C'est difficile"
  - Priorit√© audio : 1) Voix personnalis√©e ‚Üí 2) ElevenLabs ‚Üí 3) Web Speech API
  - D√©lai entre mots : 300ms
  - Comportement fin : PC (retour boutons) / Mobile (passage auto 200ms)

- **Navigation corrig√©e** : Les texte_ids sont maintenant pass√©s dans l'URL
  - `reconnaitre-les-mots.js` ‚Üí `construis-phrases?texte_ids=1,2,3`
  - Storage dans localStorage : `construis-phrases-texte-ids`
  - Retour exercices : `/lire/reconnaitre-les-mots?etape=exercices&texte_ids=...`

- **UI √©pur√©e** :
  - Suppression cadre gris d'arri√®re-plan
  - Largeurs uniformes (800px max) pour texte + boutons
  - Boutons m√™me style : fond blanc + cadre color√© (vert/orange)
  - Ic√¥nes supprim√©es (‚úÖ ‚ö†Ô∏è)
  - Mobile : masquage bouton "Passer" et texte instructions

- **D√©tection mobile r√©active** :
  - State `isMobile` avec listener resize
  - Remplacement de tous les `window.innerWidth <= 768`

- **Fonctions audio** :
  - `loadEnregistrements()` - Charge voix personnalis√©es au montage
  - `lireTTS()` - Priorit√© 1 (voix perso)
  - `lireTTSElevenLabs()` - Priorit√© 2 (ElevenLabs API)
  - `lireTTSFallback()` - Priorit√© 3 (Web Speech)
  - `demarrerKaraoke()` - Orchestration lecture s√©quentielle

### Code important
```javascript
// Mode karaok√© avec illumination
const demarrerKaraoke = () => {
    setModeKaraoke(true)
    const mots = phraseActuelle.texte.trim().split(/\s+/)

    function lireMotSuivant() {
        setMotIllumineIndex(index)
        lireTTS(mots[index], () => {
            index++
            setTimeout(lireMotSuivant, 300)
        })
    }

    // Fin : mobile (auto) vs PC (manuel)
    if (isMobile) {
        setTimeout(() => phraseReussie(), 200)
    } else {
        setModeKaraoke(false)
    }
}

// Passage texte_ids dans URL
localStorage.setItem('construis-phrases-texte-ids', router.query.texte_ids)
```

### Commit
- SHA: `68a65ef`
- Message: "Feature: Mode Karaok√© dans Construis des phrases + Corrections navigation"
- Pouss√© vers: `origin/main`

---

## [2025-11-10 01:30] - Feature: Refonte UI Construis des phrases + G√©n√©ration vari√©e

### Fichiers modifi√©s
- `pages/lire/construis-phrases/index.js` - Refonte compl√®te UI page s√©lection mode
- `pages/lire/construis-phrases/tranquille.js` - Refonte UI mode tranquille
- `pages/api/phrases/generer.js` - Am√©lioration g√©n√©ration phrases par IA

### Points cl√©s √† retenir
- **UI Construis des phrases - Page index** :
  - Suppression fond vert d√©grad√© ‚Üí fond blanc
  - Ajout barre d'ic√¥nes de navigation (‚Üê üëÅÔ∏è üìñ üè†)
  - Suppression textes descriptifs en mobile pour √©viter scroll
  - Cartes optimis√©es (padding, tailles, espacement r√©duits)
  - Coh√©rence visuelle avec √âcoute et trouve / Lis et trouve

- **UI Mode Tranquille** :
  - Suppression fond vert ‚Üí fond blanc
  - Organisation : Titre ‚Üí Phrase/Score ‚Üí Ic√¥nes ‚Üí Contenu
  - Barre d'ic√¥nes identique aux autres exercices
  - Bouton "√âcouter" dans la zone phrase (pas dans les ic√¥nes)

- **G√©n√©ration de phrases par IA** :
  - **Temp√©rature Gemini : 1.2** (au lieu de ~0.7) pour plus de cr√©ativit√©
  - **topP: 0.95, topK: 64** pour augmenter la diversit√©
  - **M√©lange al√©atoire Fisher-Yates** : les 10 phrases sont m√©lang√©es avant envoi
  - **R√©sultat** : Phrases toujours diff√©rentes √† chaque session
  - **Fallback Groq** : temp√©rature √©galement augment√©e √† 1.2

- **Pattern utilis√©** : Coh√©rence UX globale entre tous les exercices du module "Lire"

### Code important
```javascript
// G√©n√©ration Gemini avec haute temp√©rature
const model = genAI.getGenerativeModel({
    model: 'gemini-1.5-flash',
    generationConfig: {
        temperature: 1.2,  // Plus de cr√©ativit√©
        topP: 0.95,
        topK: 64
    }
})

// M√©lange al√©atoire Fisher-Yates
const shuffledPhrases = [...phrases].slice(0, 10)
for (let i = shuffledPhrases.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledPhrases[i], shuffledPhrases[j]] = [shuffledPhrases[j], shuffledPhrases[i]]
}
```

### Commit
- SHA: `7a2196f`
- Message: "Feature: Refonte UI Construis des phrases + G√©n√©ration vari√©e"
- Pouss√© vers: `origin/main`

---

## [2025-11-10 00:50] - Feature: Am√©lioration UX exercices √âcoute et trouve + Lis et trouve

### Fichiers modifi√©s
- `pages/lire/ecoute-et-trouve.js` - D√©sactivation des boutons pendant lecture audio
- `pages/lire/lis-et-trouve.js` - Ajout ic√¥ne maison + ic√¥ne fl√®che retour

### Points cl√©s √† retenir
- **√âcoute et trouve - Boutons d√©sactiv√©s pendant audio** : Les propositions de mots ne sont plus cliquables pendant que le son joue (`disabled={isPlaying}`)
  - Opacit√© r√©duite √† 50% (`opacity: isPlaying ? 0.5 : 1`)
  - Curseur "not-allowed" pendant la lecture
  - **Raison** : Emp√™cher l'utilisateur de cliquer avant la fin du son, ce qui bloquait la lecture automatique du mot suivant
- **Lis et trouve - Ic√¥ne maison** : Ajout ic√¥ne üè† discr√®te en haut √† droite de la page d'intro (position absolute, opacit√© 60%)
- **Lis et trouve - Ic√¥ne fl√®che** : Ajout ic√¥ne ‚Üê dans la barre de navigation pendant le jeu pour retour au menu exercices
- **Pattern utilis√©** : Consistency UX entre les deux exercices (m√™me style d'ic√¥nes, m√™me disposition)

### Code important
```javascript
// D√©sactivation des boutons pendant lecture audio
let buttonStyle = {
    cursor: isPlaying ? 'not-allowed' : 'pointer',
    opacity: isPlaying ? 0.5 : 1
}

<button
    disabled={completedMots.includes(mot.id) || isPlaying}
    style={buttonStyle}
>
```

### Commit
- SHA: `7b65310`
- Message: "Feature: Am√©lioration UX exercices √âcoute et trouve + Lis et trouve"
- Pouss√© vers: `origin/main`

---

## [2025-11-09 22:25] - üíæ SAUVEGARDE: R√©solution conflit MCP - Plugin vs .mcp.json

‚ö†Ô∏è **Sauvegarde avant compactage de conversation**

### Contexte
Travail sur configuration MCP pour le template New Project. D√©couverte d'un conflit entre le plugin supabase-toolkit et le fichier .mcp.json. Les serveurs du plugin prenaient la priorit√© et emp√™chaient le chargement des 7 serveurs configur√©s dans .mcp.json.

### Fichiers modifi√©s
- `/home/aclef/.claude/plugins/installed_plugins.json` - Suppression manuelle de l'entr√©e "supabase-toolkit@claude-code-templates"
- `/mnt/c/Projet ACLEF/PT3/.mcp.json` - Copi√© depuis template (7 serveurs configur√©s)
- `/mnt/c/Projet ACLEF/PT3/` - Installation compl√®te du template via `/npinstall`

### Travail en cours
- ‚úÖ Installation `/npinstall` dans PT3
- ‚úÖ Copie configuration .claude/ (39 agents, 16 commandes)
- ‚úÖ Copie fichiers templates (CLAUDE.md, R√®gles.md, .gitignore)
- ‚úÖ Copie .mcp.json avec 7 serveurs
- ‚úÖ Cr√©ation structure DEV/ avec fichier horodat√©
- ‚úÖ Installation Context Monitor via npx
- ‚úÖ Installation plugin supabase-toolkit (puis d√©sinstallation)
- ‚úÖ Identification du conflit plugin vs .mcp.json
- ‚úÖ Suppression manuelle du plugin dans installed_plugins.json
- üîÑ Attente red√©marrage Claude Code pour v√©rifier chargement des 7 serveurs

### Probl√®me identifi√©
**Conflit MCP :** Le plugin supabase-toolkit install√© GLOBALEMENT dans `/home/aclef/.claude/plugins/` chargeait ses 3 serveurs MCP et bloquait/masquait les 7 serveurs configur√©s dans `.mcp.json` du projet.

**Sympt√¥mes :**
- Commande `claude plugin uninstall supabase-toolkit` retournait "already uninstalled"
- MAIS le plugin √©tait toujours pr√©sent dans `installed_plugins.json`
- DONC ses 3 serveurs MCP se chargeaient quand m√™me
- Les 7 serveurs du `.mcp.json` n'√©taient jamais charg√©s

**Solution appliqu√©e :**
- √âdition manuelle de `/home/aclef/.claude/plugins/installed_plugins.json`
- Suppression des lignes 4-11 (entr√©e supabase-toolkit)
- Red√©marrage Claude Code requis pour v√©rifier

### Points cl√©s √† retenir
- **Plugin vs .mcp.json** : Les plugins install√©s globalement prennent la priorit√© sur .mcp.json
- **Bug d√©sinstallation** : La commande `claude plugin uninstall` peut √©chouer silencieusement
- **Fichier de r√©f√©rence** : `/home/aclef/.claude/plugins/installed_plugins.json` contient la vraie liste
- **Commande /npinstall** : Ne devrait PAS installer le plugin supabase-toolkit, seulement copier .mcp.json
- **Format chemin WSL** : Toujours utiliser `/mnt/c/...` et non `C:\...`

### Serveurs MCP attendus (apr√®s red√©marrage)
1. **supabase** - Toolkit Supabase (projet: mkbchdhbgdynxwfhpxbw)
2. **github** - Int√©gration GitHub
3. **sequential-thinking** - Raisonnement s√©quentiel
4. **deepwiki** - Documentation technique (HTTP)
5. **serena** - Assistant de recherche (uvx)
6. **memory** - M√©moire de session
7. **memory-bank** - M√©moire persistante (`/mnt/c/Projet ACLEF/.memory-bank`)

### Configuration .mcp.json
```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": ["-y", "@supabase/mcp-server-supabase@latest", "--project-ref=mkbchdhbgdynxwfhpxbw"],
      "env": {"SUPABASE_ACCESS_TOKEN": "sbp_..."}
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {"GITHUB_PERSONAL_ACCESS_TOKEN": "github_pat_..."}
    },
    "sequential-thinking": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"]
    },
    "deepwiki": {
      "url": "https://mcp.deepwiki.com/mcp",
      "transport": "http"
    },
    "serena": {
      "command": "uvx",
      "args": ["--from", "git+https://github.com/oraios/serena", "serena", "start-mcp-server"]
    },
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    },
    "memory-bank": {
      "command": "npx",
      "args": ["-y", "@allpepper/memory-bank-mcp@latest"],
      "env": {"MEMORY_BANK_ROOT": "/mnt/c/Projet ACLEF/.memory-bank"}
    }
  }
}
```

### Notes pour la prochaine session
- **Action imm√©diate** : Red√©marrer Claude Code dans "New Project" et v√©rifier que les 7 serveurs se chargent
- **Si succ√®s** : Mettre √† jour `/npinstall` pour NE PAS installer le plugin supabase-toolkit
- **Si √©chec** : Envisager configuration manuelle des serveurs MCP via Settings UI
- **Alternative** : Utiliser uniquement .mcp.json et supprimer toute r√©f√©rence au plugin
- **Documentation** : Le fichier .mcp.json du projet EST vu par Claude Code mais peut √™tre masqu√© par les plugins globaux

### Workflow utilis√©
1. `/regles` - Rappel des r√®gles
2. `/npinstall /mnt/c/Projet ACLEF/PT3` - Installation template
3. D√©tection probl√®me MCP (seulement 3 serveurs au lieu de 7)
4. Investigation : lecture installed_plugins.json
5. √âdition manuelle pour supprimer le plugin
6. Sauvegarde DEV.md avant test final

---

## [2025-11-09 18:55] - üíæ SAUVEGARDE: Installation template New Project + Configuration MCP & Context Monitor

‚ö†Ô∏è **Sauvegarde de routine apr√®s travail termin√©**

### Contexte
Session compl√®te d'installation et configuration du template New Project. Installation test r√©ussie dans "Projet test" et mise √† jour du template GitHub avec nouvelles fonctionnalit√©s.

### Fichiers modifi√©s

**Template New Project (GitHub):**
- `.mcp.json` - Ajout configuration 7 serveurs MCP (Supabase, GitHub, Sequential-thinking, DeepWiki, Serena, Memory, Memory-Bank)
- `templates/.gitignore.template` - Ajout exclusion `.mcp.json` (protection tokens sensibles)
- `.claude/scripts/context-monitor.py` - Script Python de monitoring contexte en temps r√©el
- `.claude/settings.local.json` - Configuration statusLine pour context-monitor (local, non commit√©)

**Projet test (/mnt/c/Projet ACLEF/Projet test):**
- Structure compl√®te install√©e via `/npinstall`
- Configuration `.claude/` (39 agents, 16 commandes)
- Fichiers `CLAUDE.md`, `R√®gles.md`, `.gitignore`
- Structure `DEV/` avec journal horodat√©
- Configuration `.mcp.json` avec serveurs MCP
- Script `context-monitor.py` install√©

### Travail en cours
- ‚úÖ Ex√©cution `/npinstall` pour "Projet test"
- ‚úÖ D√©tection absence `.mcp.json` dans template
- ‚úÖ Copie `.mcp.json` depuis projet p√©dagogie vers template
- ‚úÖ Mise √† jour `.gitignore` pour exclure `.mcp.json`
- ‚úÖ Installation `statusline/context-monitor` dans template ET Projet test
- ‚úÖ Commit et push vers GitHub (2 commits)
- ‚úÖ Sauvegarde dans DEV.md

### Points cl√©s √† retenir
- **Commande `/npinstall`** : Installe uniquement la configuration Claude (pas l'architecture projet)
- **Format chemin WSL** : Utiliser `/mnt/c/...` et non `C:\...`
- **Configuration MCP** : 7 serveurs install√©s (tokens sensibles prot√©g√©s par gitignore)
- **Context Monitor** : Affiche barres progression, alertes color√©es, analytics session dans statusline
- **Pattern utilis√©** : Template r√©utilisable pour standardiser configuration sur tous les projets
- **S√©curit√©** : `.mcp.json` exclu du git via `.gitignore` (contient tokens Supabase et GitHub)

### Serveurs MCP configur√©s
1. **supabase** - Toolkit Supabase (projet: mkbchdhbgdynxwfhpxbw)
2. **github** - Int√©gration GitHub
3. **sequential-thinking** - Raisonnement s√©quentiel
4. **deepwiki** - Documentation technique
5. **serena** - Assistant de recherche
6. **memory** - M√©moire de session
7. **memory-bank** - M√©moire persistante (`/mnt/c/Projet ACLEF/.memory-bank`)

### Commits GitHub
- **Commit `9e6541f`** : Feature: Ajout configuration MCP serveurs dans template
- **Commit `ee48312`** : Feature: Ajout context-monitor pour suivi utilisation tokens
- **D√©p√¥t** : https://github.com/Allakabeth/New-project.git
- **Branche** : main

### Code/Configuration importante

**Configuration statusLine (settings.local.json):**
```json
{
  "statusLine": {
    "type": "command",
    "command": "python3 .claude/scripts/context-monitor.py"
  }
}
```

**Exclusion gitignore:**
```gitignore
# MCP Configuration (contains sensitive tokens)
.mcp.json
```

### Notes pour la prochaine session
- Template New Project maintenant complet avec MCP + Context Monitor
- Tous les futurs projets cr√©√©s avec `/npinstall` auront automatiquement :
  - Configuration MCP (7 serveurs)
  - Context Monitor dans statusline
  - Protection des tokens sensibles
- Prochaine √©tape : Tester `/npinit` pour g√©n√©rer architecture projet via questionnaire
- Journal DEV horodat√© fonctionne parfaitement

### Workflow utilis√©
1. `/regles` - Rappel des r√®gles de travail
2. `/npinstall` - Installation template dans nouveau projet
3. D√©tection probl√®me ‚Üí Question ‚Üí Validation ‚Üí Ex√©cution
4. Installation MCP (copie + gitignore)
5. Installation context-monitor (npx claude-code-templates)
6. `/push` - Commit + Push GitHub
7. `/save` - Sauvegarde DEV.md

---

## [2025-11-09 15:35] - üíæ SAUVEGARDE: Session de configuration initiale

‚ö†Ô∏è **Sauvegarde de routine - aucun travail en cours**

### Contexte
Session tr√®s courte - uniquement push de la r√©organisation documentation. Aucune modification de code.

### Fichiers modifi√©s
- Aucun fichier de code modifi√© dans cette session

### Travail en cours
- ‚úÖ Push de la r√©organisation documentation (commit `a472197`)
- ‚úÖ Mise √† jour journal DEV
- ‚úÖ V√©rification commandes /push et /save

### Points cl√©s √† retenir
- **Commande /push** : Fonctionne correctement pour git commit + push + mise √† jour DEV.md
- **Commande /save** : Test√©e, permet sauvegarde sans commit
- **Nouveau workflow** : Fichiers DEV horodat√©s cr√©√©s automatiquement au d√©but de chaque session

### Notes pour la prochaine session
- Session de configuration termin√©e
- Pr√™t pour du vrai travail de d√©veloppement
- Tous les rituels en place (DEV.md, r√®gles, commandes)

---

## [2025-11-09 15:30] - Docs: R√©organisation structure documentation

### Fichiers modifi√©s
- `CLAUDE2.md` - Supprim√© (obsol√®te)
- `DEV.md` - Supprim√© (remplac√© par structure horodat√©e)
- `DEV/DEV_09112025_15_30.md` - Cr√©√© (nouveau journal horodat√©)
- `DEV/DEV.md` - Cr√©√© (archive des anciennes entr√©es)
- `CLAUDE.md` - Mis √† jour (clarifications mineures)

### Points cl√©s √† retenir
- **Structure DEV/** : Nouveau syst√®me de journaux horodat√©s pour suivre les sessions
- **Pattern utilis√©** : Un fichier par session (format `DEV_JJMMAAAA_HH_MM.md`)
- **Objectif** : Meilleure tra√ßabilit√© chronologique des modifications

### Commit
- SHA: `a472197`
- Message: "Docs: R√©organisation structure documentation"
- Pouss√© vers: `origin/main`

---
