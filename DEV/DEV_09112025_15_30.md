# DEV - Session du 09/11/2025 15:30

## D√©but de session

- Date : 09/11/2025
- Heure : 15:30
- Contexte : Nouvelle session de d√©veloppement
- Projet : ACLEF P√©dagogique

---

## Notes de session

---

## [2025-11-10 07:15] - üíæ SAUVEGARDE 2: Correction API Gemini + Fallback JavaScript + Logs debug

‚ö†Ô∏è **Sauvegarde avant compactage de conversation**

### Contexte
Conversation √† 66K/200K restants (33%) - Sauvegarde apr√®s correction bugs g√©n√©ration phrases.

### Fichiers modifi√©s
- `pages/api/phrases/generer.js` - Correction mod√®le Gemini + Fallback JS + Logs d√©taill√©s

### Probl√®mes rencontr√©s et r√©solus

**Probl√®me 1 : Mod√®le Gemini 404**
- **Erreur** : `gemini-1.5-flash is not found for API version v1beta`
- **Cause** : Nom de mod√®le obsol√®te
- **Solution** : Chang√© en `gemini-1.5-flash-latest`

**Probl√®me 2 : Quotas IA √©puis√©s**
- **Sympt√¥me** : Gemini et Groq √©chouent tous les deux
- **Cause** : Probablement quotas gratuits consomm√©s par les tests (50 phrases √ó plusieurs essais)
- **Solution** : Ajout fallback JavaScript qui g√©n√®re des phrases simples

**Probl√®me 3 : Filtre anti-duplication trop strict**
- **Sympt√¥me** : Seulement 2-8 phrases g√©n√©r√©es au lieu de 10
- **Cause** : Rejetait les phrases avec les 2 m√™mes premiers mots
- **Solution** : Assoupli pour rejeter seulement les phrases exactement identiques

### Code ajout√© - Fallback JavaScript

**G√©n√©rateur de phrases simple quand IA indisponible :**
```javascript
if (phrases.length === 0) {
    console.log('‚ö†Ô∏è Aucune IA disponible - G√©n√©ration fallback JavaScript')

    const templates = [
        (mots) => `${mots[0]} ${mots[1]}.`,
        (mots) => `${mots[0]} ${mots[1]} ${mots[2]}.`,
        (mots) => `${mots[0]} ${mots[1]} ${mots[2]} ${mots[3]}.`,
        (mots) => `${mots[0]} ${mots[1]} ${mots[2]} ${mots[3]} ${mots[4]}.`,
    ]

    const phrasesGenereesJS = []
    const motsShuffled = [...motsUniques]

    // Fisher-Yates pour m√©langer les mots
    for (let i = motsShuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [motsShuffled[i], motsShuffled[j]] = [motsShuffled[j], motsShuffled[i]]
    }

    // G√©n√©rer 15 phrases simples (3-5 mots)
    for (let i = 0; i < Math.min(15, Math.floor(motsShuffled.length / 3)); i++) {
        const taille = Math.min(3 + (i % 3), 5)
        const debut = i * 3
        const motsPhrase = motsShuffled.slice(debut, debut + taille)

        if (motsPhrase.length >= 3) {
            const template = templates[Math.min(motsPhrase.length - 2, templates.length - 1)]
            const texte = template(motsPhrase)
            phrasesGenereesJS.push({
                texte: texte,
                mots: motsPhrase
            })
        }
    }

    phrases = phrasesGenereesJS
    console.log(`‚úÖ ${phrases.length} phrases g√©n√©r√©es en fallback JavaScript`)
}
```

### Logs debug ajout√©s

**Pour Gemini :**
```javascript
console.log(`üìä Gemini a g√©n√©r√© ${parsed.phrases.length} phrases brutes`)
console.log(`‚úÖ ${phrasesValides.length} phrases valides apr√®s validation des mots`)
console.log(`‚úÖ ${phrases.length} phrases UNIQUES g√©n√©r√©es par Gemini`)
```

**Pour Groq :**
```javascript
console.log('üîÑ Tentative Groq avec API key pr√©sente:', !!process.env.GROQ_API_KEY)
console.log('üì° R√©ponse Groq status:', groqResponse.status)
// Si erreur:
console.error('‚ùå Groq a √©chou√©. Status:', groqResponse.status)
console.error('‚ùå Erreur Groq:', errorText)
```

### Modifications filtre anti-duplication

**Avant (TROP STRICT) :**
```javascript
// Rejetait si m√™mes 2 premiers mots
const debut = mots.slice(0, 2).join(' ').toLowerCase()
if (debutsVus.has(debut)) return false
```

**Apr√®s (SOUPLE) :**
```javascript
// Rejette seulement si phrase exactement identique
const texteNormalise = p.texte.toLowerCase().replace(/[.!?,;:]/g, '').trim()
if (textesVus.has(texteNormalise)) return false
```

### Avantages fallback JavaScript

‚úÖ **Fonctionne toujours** - Aucune d√©pendance externe, pas de quota
‚úÖ **100% mots autoris√©s** - Utilise uniquement les mots fournis
‚úÖ **Vari√©t√© garantie** - Fisher-Yates shuffle pour m√©lange al√©atoire
‚úÖ **Phrases simples mais valides** - 3 √† 5 mots par phrase
‚ö†Ô∏è **Pas de grammaire** - Phrases moins naturelles que l'IA

### √âtat actuel
- ‚úÖ Mod√®le Gemini corrig√© (`gemini-1.5-flash-latest`)
- ‚úÖ Fallback JavaScript op√©rationnel
- ‚úÖ Logs d√©taill√©s pour debug
- ‚úÖ Filtre anti-duplication assoupli
- ‚ö†Ô∏è **NON TEST√â** en situation r√©elle
- ‚ö†Ô∏è **NON COMMIT√â** sur Git

### V√©rifier dans les logs

Lors du prochain test, v√©rifier console serveur :
```
üìö G√©n√©ration de phrases avec X mots
ü§ñ Tentative avec Gemini...
üìä Gemini a g√©n√©r√© 50 phrases brutes
‚úÖ 35 phrases valides apr√®s validation des mots
‚úÖ 33 phrases UNIQUES g√©n√©r√©es par Gemini
```

OU si quotas √©puis√©s :
```
‚ùå Erreur Gemini: [quota d√©pass√©]
üîÑ Tentative avec Groq...
‚ùå Groq a √©chou√©. Status: 429
‚ö†Ô∏è Aucune IA disponible - G√©n√©ration fallback JavaScript
‚úÖ 15 phrases g√©n√©r√©es en fallback JavaScript
```

### √Ä faire prochaine session
1. **TESTER** avec fallback JavaScript actif
2. V√©rifier quotas Gemini/Groq ou attendre renouvellement
3. Si fallback OK ‚Üí peut rester comme solution permanente
4. Si besoin IA ‚Üí cr√©er nouvelles cl√©s gratuites
5. Une fois stable ‚Üí `/push` pour commit

### Notes importantes
- **Fallback JS** : G√©n√®re phrases basiques mais fonctionnelles
- **Quotas IA** : Probablement √©puis√©s par tests multiples (50√óN phrases)
- **Fisher-Yates** : Utilis√© partout pour vrai hasard
- **Logs** : Permettent maintenant de voir exactement o√π √ßa bloque

---

## [2025-11-10 06:45] - üíæ SAUVEGARDE: Refonte UI Mode D√©fi + Audio mot-par-mot + Anti-duplication phrases

‚ö†Ô∏è **Sauvegarde avant compactage de conversation**

### Contexte
Conversation proche de la limite de tokens (81K/200K restants) - sauvegarde des modifications non push√©es.

### Fichiers modifi√©s
- `pages/lire/construis-phrases/defi.js` - Refonte compl√®te UI + feedback visuel + audio mot-par-mot
- `pages/api/phrases/generer.js` - Am√©lioration vari√©t√© phrases + filtre anti-duplication

### Travail effectu√©
- ‚úÖ **Refonte UI Mode D√©fi** - Interface √©pur√©e 3 lignes (titre, progress/score, ic√¥nes)
- ‚úÖ **Feedback visuel mot-par-mot** - Bordures vertes/rouges selon correction
- ‚úÖ **Bouton Valider/Suivant** - Logique conditionnelle selon r√©sultat
- ‚úÖ **Suppression "Essaye encore"** - Plus de feedback n√©gatif
- ‚úÖ **M√©lange Fisher-Yates** - Vrai hasard pour mots + intrus
- ‚úÖ **Audio mot-par-mot** - Priorit√© voix perso ‚Üí ElevenLabs ‚Üí Web Speech (sauf Hortense)
- ‚úÖ **Anti-duplication phrases** - Filtre sur 2 premiers mots identiques
- ‚úÖ **Longueur harmonis√©e** - 3-8 mots max (prompt + code)
- ‚úÖ **Prompt am√©lior√©** - Force vari√©t√© structures et d√©buts diff√©rents

### UI Mode D√©fi - D√©tails

**Structure 3 lignes :**
```
Ligne 1: üéØ Mode D√©fi
Ligne 2: Phrase X/Y                Score: X/Y
Ligne 3: ‚Üê üëÅÔ∏è üìñ üè† üîä
```

**Fond blanc** (plus de bleu), **pas de cadre**

**Feedback visuel mots :**
- Avant validation : fond gris `#f3f4f6`, bordure violette
- Apr√®s validation :
  - Bordure **verte** `#10b981` si correct
  - Bordure **rouge** `#ef4444` si incorrect
  - Fond reste gris neutre

**Logique boutons :**
- Si **tout vert** ‚Üí passage auto apr√®s 2s ‚úÖ
- Si **du rouge** ‚Üí affiche bouton "‚Üí Suivant" (bleu)
- Impossible de modifier apr√®s validation

### Audio mot-par-mot

**Syst√®me de lecture phrase :**
```javascript
// 1. D√©coupe phrase en mots
const mots = text.split(/\s+/).filter(...)

// 2. Lecture s√©quentielle SANS pause
function lireMotSuivant() {
    lireUnMot(mots[index], () => {
        index++
        lireMotSuivant() // Encha√Æne directement
    })
}
```

**Priorit√©s pour chaque mot :**
1. **Voix personnalis√©e apprenant** (si enregistr√©e)
2. **ElevenLabs** (si token disponible)
3. **Web Speech API** (fran√ßaise sauf Hortense)

**Normalisation mot :**
- Lowercase + suppression ponctuation
- Matching exact dans `enregistrementsMap`

### Anti-duplication phrases IA

**Probl√®me identifi√© :**
- IA g√©n√©rait phrases commen√ßant toutes par "Je suis..."
- Seulement 8 phrases au lieu de 10
- Longueur incoh√©rente (jusqu'√† 10 mots alors que prompt disait 8)

**Solutions appliqu√©es :**

**1. Prompt am√©lior√© :**
```
4. IMP√âRATIF : VARIE ABSOLUMENT les d√©buts de phrases :
   - Ne commence JAMAIS deux phrases de suite par le m√™me mot
   - Ne commence JAMAIS deux phrases de suite par les deux m√™mes mots
   - Alterne les sujets, les actions, les structures
```

**2. Filtre anti-duplication c√¥t√© code :**
```javascript
const debutsVus = new Set()
phrases = phrasesValides.filter(p => {
    const debut = p.texte.split(/\s+/).slice(0, 2).join(' ').toLowerCase()

    if (debutsVus.has(debut)) {
        console.log(`‚ö†Ô∏è Phrase rejet√©e (d√©but dupliqu√©): "${p.texte}"`)
        return false
    }

    debutsVus.add(debut)
    return true
})
```

**3. Longueur harmonis√©e :**
- Prompt : 3-8 mots MAXIMUM
- Code : `p.mots.length > 8` ‚Üí rejet
- Appliqu√© √† Gemini ET Groq

### Points cl√©s √† retenir

**Pattern audio mot-par-mot :**
- Fonction r√©cursive avec callback `onEnded`
- Pas de `setTimeout()` ‚Üí encha√Ænement direct
- Normalisation pour matching enregistrements

**Pattern feedback visuel :**
- √âtat `motsStatuts[]` stocke statut de chaque mot
- Comparaison position par position avec phrase attendue
- Bordure uniquement (pas de fond color√©)

**Pattern anti-duplication :**
- Set() pour tracking d√©buts de phrases
- V√©rification sur 2 premiers mots (pas juste 1)
- Appliqu√© apr√®s validation stricte des mots

**M√©lange Fisher-Yates :**
```javascript
for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]]
}
```
Plus fiable que `.sort(() => Math.random() - 0.5)`

### Textes masqu√©s mobile

Sur mobile uniquement, textes suivants cach√©s avec `{!isMobile && (...)}` :
- "üéß √âcoute et construis la phrase :"
- "Mots disponibles :"
- "Clique sur les mots dans le bon ordre..."

Interface plus √©pur√©e sur petit √©cran.

### Code important

**Fonction validation mot-par-mot :**
```javascript
const verifierPhrase = (motsConstruit) => {
    setAttempts(attempts + 1)

    const motsAttendus = phraseActuelle.mots.map(m => m.toLowerCase())
    const statuts = motsConstruit.map((mot, index) => ({
        mot: mot,
        correct: index < motsAttendus.length && mot.toLowerCase() === motsAttendus[index]
    }))

    setMotsStatuts(statuts)
    const toutCorrect = statuts.every(s => s.correct) && statuts.length === motsAttendus.length

    if (toutCorrect) {
        // Passage auto apr√®s 2s
        setTimeout(() => { /* phrase suivante */ }, 2000)
    } else {
        setAfficherBoutonSuivant(true) // Bouton Suivant
    }
}
```

**Fonction lecture mot-par-mot :**
```javascript
const lirePhrase = async (text) => {
    const mots = text.trim().split(/\s+/).filter(...)
    let index = 0

    function lireMotSuivant() {
        if (index >= mots.length) {
            setIsPlaying(false)
            return
        }

        lireUnMot(mots[index], () => {
            index++
            lireMotSuivant() // Pas de d√©lai !
        })
    }

    lireMotSuivant()
}
```

### √âtat actuel
- ‚úÖ Toutes les modifications fonctionnelles
- ‚ö†Ô∏è **NON TEST√â en situation r√©elle**
- ‚ö†Ô∏è **NON COMMIT√â sur Git**

### √Ä faire prochaine session
1. **TESTER** le mode d√©fi complet :
   - Feedback visuel vert/rouge
   - Audio mot-par-mot avec voix perso
   - Bouton Suivant conditionnel
   - Vari√©t√© des phrases g√©n√©r√©es
2. Si OK ‚Üí `/push` avec commit
3. V√©rifier logs console pour anti-duplication
4. Tester avec diff√©rentes listes de mots (courtes/longues)

### Notes importantes
- **Audio** : Les enregistrements perso doivent √™tre dans `enregistrementsMap` (normalis√©s en lowercase)
- **Validation** : Aucun fallback hardcod√©, toujours validation stricte IA
- **Fisher-Yates** : Utilis√© pour mots ET pour s√©lection phrases finales
- **Hortense** : Explicitement exclue dans voix navigateur

---

## [2025-11-10 05:30] - Feature: Validation stricte mots + Navigation fluide Construis des phrases

### Fichiers modifi√©s
- `pages/api/phrases/generer.js` - Validation stricte des mots g√©n√©r√©s par IA
- `pages/lire/construis-phrases/tranquille.js` - Passage texte_ids dans URL au retour
- `pages/lire/construis-phrases/difficile.js` - Passage texte_ids dans URL au retour
- `pages/lire/construis-phrases/defi.js` - Passage texte_ids dans URL au retour
- `pages/lire/reconnaitre-les-mots.js` - Chargement automatique mots + stockage texte_ids

### Points cl√©s √† retenir

**Validation stricte g√©n√©ration phrases IA :**
- **Probl√®me identifi√©** : L'IA (Gemini/Groq) pouvait ajouter des mots hors-liste et g√©n√©rer du contenu ind√©cent
- **Solution** : Validation stricte c√¥t√© serveur apr√®s g√©n√©ration
- **Fonctions ajout√©es** :
  - `normalizeWord()` - Normalise mots (minuscules, sans accents, sans ponctuation)
  - `validatePhrase()` - V√©rifie que CHAQUE mot est dans la liste autoris√©e
- **Temp√©rature optimis√©e** : 1.2 ‚Üí 0.9 (cr√©ativit√© contr√¥l√©e)
- **G√©n√©ration augment√©e** : 10 ‚Üí 50 phrases pour pool de vari√©t√©
- **S√©lection al√©atoire** : 10 phrases choisies au hasard parmi les valides
- **Prompt encourageant** : Remplac√© warnings par encouragement √† la cr√©ativit√©
- **R√©sultat** : Z√âRO risque de mots hors-liste ou contenu inappropri√©

**Correction navigation Construis des phrases :**
- **Probl√®me** : Clic sur ‚Üê depuis construis-phrases ‚Üí menu exercices ne savait plus quels textes √©taient s√©lectionn√©s ‚Üí bouton gris√©
- **Solution** : M√™me pattern que "√âcoute et trouve"
  - Boutons ‚Üê passent `texte_ids` dans URL
  - `chargerGroupesSens()` stocke automatiquement mots + texte_ids dans localStorage
  - Bouton "Construis des phrases" v√©rifie d'abord si mots d√©j√† stock√©s
- **B√©n√©fice** : Navigation fluide sans perte de contexte

### Code important

```javascript
// Validation stricte des mots
function validatePhrase(phrase, motsAutorisesNormalises) {
    const motsPhrase = phrase.texte
        .replace(/[.!?,;:]/g, '')
        .split(/\s+/)
        .filter(m => m.length > 0)

    for (const mot of motsPhrase) {
        const motNorm = normalizeWord(mot)
        if (!motsAutorisesNormalises.includes(motNorm)) {
            console.log(`‚ùå Phrase rejet√©e - Mot non autoris√©: "${mot}"`)
            return false
        }
    }
    return true
}

// G√©n√©ration avec validation
const motsAutorisesNormalises = motsUniques.map(normalizeWord)
phrases = parsed.phrases.filter(p => {
    if (!p.texte || !p.mots || !Array.isArray(p.mots)) return false
    if (p.mots.length < 3 || p.mots.length > 10) return false
    return validatePhrase(p, motsAutorisesNormalises) // ‚ö†Ô∏è VALIDATION STRICTE
})

// S√©lection al√©atoire (Fisher-Yates)
const shuffledPhrases = [...phrases]
for (let i = shuffledPhrases.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledPhrases[i], shuffledPhrases[j]] = [shuffledPhrases[j], shuffledPhrases[i]]
}
const selectedPhrases = shuffledPhrases.slice(0, 10)
```

### Workflow utilis√©
1. Identification probl√®me validation mots IA
2. Planification solution avec TodoWrite
3. Impl√©mentation validation stricte (fonctions + filtrage)
4. Identification probl√®me navigation
5. Application pattern "√âcoute et trouve" pour construis-phrases
6. Tests et validation

### Commit
- SHA: `f6be168`
- Message: "Feature: Validation stricte mots + Navigation fluide Construis des phrases"
- Pouss√© vers: `origin/main`

---

## [2025-11-10 03:45] - Feature: Mode Karaok√© dans Construis des phrases + Corrections navigation

### Fichiers modifi√©s
- `pages/lire/construis-phrases/tranquille.js` - Ajout mode karaok√© avec lecture s√©quentielle
- `pages/lire/construis-phrases/index.js` - Stockage texte_ids + navigation corrig√©e
- `pages/lire/construis-phrases/difficile.js` - Navigation corrig√©e
- `pages/lire/construis-phrases/defi.js` - Navigation corrig√©e
- `pages/lire/reconnaitre-les-mots.js` - Passage texte_ids dans URL vers construis-phrases

### Points cl√©s √† retenir
- **Mode karaok√©** : Lecture s√©quentielle avec illumination jaune des mots (#fef08a)
  - D√©clenchement : Bouton "C'est difficile"
  - Priorit√© audio : 1) Voix personnalis√©e ‚Üí 2) ElevenLabs ‚Üí 3) Web Speech API
  - D√©lai entre mots : 300ms
  - Comportement fin : PC (retour boutons) / Mobile (passage auto 200ms)

- **Navigation corrig√©e** : Les texte_ids sont maintenant pass√©s dans l'URL
  - `reconnaitre-les-mots.js` ‚Üí `construis-phrases?texte_ids=1,2,3`
  - Storage dans localStorage : `construis-phrases-texte-ids`
  - Retour exercices : `/lire/reconnaitre-les-mots?etape=exercices&texte_ids=...`

- **UI √©pur√©e** :
  - Suppression cadre gris d'arri√®re-plan
  - Largeurs uniformes (800px max) pour texte + boutons
  - Boutons m√™me style : fond blanc + cadre color√© (vert/orange)
  - Ic√¥nes supprim√©es (‚úÖ ‚ö†Ô∏è)
  - Mobile : masquage bouton "Passer" et texte instructions

- **D√©tection mobile r√©active** :
  - State `isMobile` avec listener resize
  - Remplacement de tous les `window.innerWidth <= 768`

- **Fonctions audio** :
  - `loadEnregistrements()` - Charge voix personnalis√©es au montage
  - `lireTTS()` - Priorit√© 1 (voix perso)
  - `lireTTSElevenLabs()` - Priorit√© 2 (ElevenLabs API)
  - `lireTTSFallback()` - Priorit√© 3 (Web Speech)
  - `demarrerKaraoke()` - Orchestration lecture s√©quentielle

### Code important
```javascript
// Mode karaok√© avec illumination
const demarrerKaraoke = () => {
    setModeKaraoke(true)
    const mots = phraseActuelle.texte.trim().split(/\s+/)

    function lireMotSuivant() {
        setMotIllumineIndex(index)
        lireTTS(mots[index], () => {
            index++
            setTimeout(lireMotSuivant, 300)
        })
    }

    // Fin : mobile (auto) vs PC (manuel)
    if (isMobile) {
        setTimeout(() => phraseReussie(), 200)
    } else {
        setModeKaraoke(false)
    }
}

// Passage texte_ids dans URL
localStorage.setItem('construis-phrases-texte-ids', router.query.texte_ids)
```

### Commit
- SHA: `68a65ef`
- Message: "Feature: Mode Karaok√© dans Construis des phrases + Corrections navigation"
- Pouss√© vers: `origin/main`

---

## [2025-11-10 01:30] - Feature: Refonte UI Construis des phrases + G√©n√©ration vari√©e

### Fichiers modifi√©s
- `pages/lire/construis-phrases/index.js` - Refonte compl√®te UI page s√©lection mode
- `pages/lire/construis-phrases/tranquille.js` - Refonte UI mode tranquille
- `pages/api/phrases/generer.js` - Am√©lioration g√©n√©ration phrases par IA

### Points cl√©s √† retenir
- **UI Construis des phrases - Page index** :
  - Suppression fond vert d√©grad√© ‚Üí fond blanc
  - Ajout barre d'ic√¥nes de navigation (‚Üê üëÅÔ∏è üìñ üè†)
  - Suppression textes descriptifs en mobile pour √©viter scroll
  - Cartes optimis√©es (padding, tailles, espacement r√©duits)
  - Coh√©rence visuelle avec √âcoute et trouve / Lis et trouve

- **UI Mode Tranquille** :
  - Suppression fond vert ‚Üí fond blanc
  - Organisation : Titre ‚Üí Phrase/Score ‚Üí Ic√¥nes ‚Üí Contenu
  - Barre d'ic√¥nes identique aux autres exercices
  - Bouton "√âcouter" dans la zone phrase (pas dans les ic√¥nes)

- **G√©n√©ration de phrases par IA** :
  - **Temp√©rature Gemini : 1.2** (au lieu de ~0.7) pour plus de cr√©ativit√©
  - **topP: 0.95, topK: 64** pour augmenter la diversit√©
  - **M√©lange al√©atoire Fisher-Yates** : les 10 phrases sont m√©lang√©es avant envoi
  - **R√©sultat** : Phrases toujours diff√©rentes √† chaque session
  - **Fallback Groq** : temp√©rature √©galement augment√©e √† 1.2

- **Pattern utilis√©** : Coh√©rence UX globale entre tous les exercices du module "Lire"

### Code important
```javascript
// G√©n√©ration Gemini avec haute temp√©rature
const model = genAI.getGenerativeModel({
    model: 'gemini-1.5-flash',
    generationConfig: {
        temperature: 1.2,  // Plus de cr√©ativit√©
        topP: 0.95,
        topK: 64
    }
})

// M√©lange al√©atoire Fisher-Yates
const shuffledPhrases = [...phrases].slice(0, 10)
for (let i = shuffledPhrases.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledPhrases[i], shuffledPhrases[j]] = [shuffledPhrases[j], shuffledPhrases[i]]
}
```

### Commit
- SHA: `7a2196f`
- Message: "Feature: Refonte UI Construis des phrases + G√©n√©ration vari√©e"
- Pouss√© vers: `origin/main`

---

## [2025-11-10 00:50] - Feature: Am√©lioration UX exercices √âcoute et trouve + Lis et trouve

### Fichiers modifi√©s
- `pages/lire/ecoute-et-trouve.js` - D√©sactivation des boutons pendant lecture audio
- `pages/lire/lis-et-trouve.js` - Ajout ic√¥ne maison + ic√¥ne fl√®che retour

### Points cl√©s √† retenir
- **√âcoute et trouve - Boutons d√©sactiv√©s pendant audio** : Les propositions de mots ne sont plus cliquables pendant que le son joue (`disabled={isPlaying}`)
  - Opacit√© r√©duite √† 50% (`opacity: isPlaying ? 0.5 : 1`)
  - Curseur "not-allowed" pendant la lecture
  - **Raison** : Emp√™cher l'utilisateur de cliquer avant la fin du son, ce qui bloquait la lecture automatique du mot suivant
- **Lis et trouve - Ic√¥ne maison** : Ajout ic√¥ne üè† discr√®te en haut √† droite de la page d'intro (position absolute, opacit√© 60%)
- **Lis et trouve - Ic√¥ne fl√®che** : Ajout ic√¥ne ‚Üê dans la barre de navigation pendant le jeu pour retour au menu exercices
- **Pattern utilis√©** : Consistency UX entre les deux exercices (m√™me style d'ic√¥nes, m√™me disposition)

### Code important
```javascript
// D√©sactivation des boutons pendant lecture audio
let buttonStyle = {
    cursor: isPlaying ? 'not-allowed' : 'pointer',
    opacity: isPlaying ? 0.5 : 1
}

<button
    disabled={completedMots.includes(mot.id) || isPlaying}
    style={buttonStyle}
>
```

### Commit
- SHA: `7b65310`
- Message: "Feature: Am√©lioration UX exercices √âcoute et trouve + Lis et trouve"
- Pouss√© vers: `origin/main`

---

## [2025-11-09 22:25] - üíæ SAUVEGARDE: R√©solution conflit MCP - Plugin vs .mcp.json

‚ö†Ô∏è **Sauvegarde avant compactage de conversation**

### Contexte
Travail sur configuration MCP pour le template New Project. D√©couverte d'un conflit entre le plugin supabase-toolkit et le fichier .mcp.json. Les serveurs du plugin prenaient la priorit√© et emp√™chaient le chargement des 7 serveurs configur√©s dans .mcp.json.

### Fichiers modifi√©s
- `/home/aclef/.claude/plugins/installed_plugins.json` - Suppression manuelle de l'entr√©e "supabase-toolkit@claude-code-templates"
- `/mnt/c/Projet ACLEF/PT3/.mcp.json` - Copi√© depuis template (7 serveurs configur√©s)
- `/mnt/c/Projet ACLEF/PT3/` - Installation compl√®te du template via `/npinstall`

### Travail en cours
- ‚úÖ Installation `/npinstall` dans PT3
- ‚úÖ Copie configuration .claude/ (39 agents, 16 commandes)
- ‚úÖ Copie fichiers templates (CLAUDE.md, R√®gles.md, .gitignore)
- ‚úÖ Copie .mcp.json avec 7 serveurs
- ‚úÖ Cr√©ation structure DEV/ avec fichier horodat√©
- ‚úÖ Installation Context Monitor via npx
- ‚úÖ Installation plugin supabase-toolkit (puis d√©sinstallation)
- ‚úÖ Identification du conflit plugin vs .mcp.json
- ‚úÖ Suppression manuelle du plugin dans installed_plugins.json
- üîÑ Attente red√©marrage Claude Code pour v√©rifier chargement des 7 serveurs

### Probl√®me identifi√©
**Conflit MCP :** Le plugin supabase-toolkit install√© GLOBALEMENT dans `/home/aclef/.claude/plugins/` chargeait ses 3 serveurs MCP et bloquait/masquait les 7 serveurs configur√©s dans `.mcp.json` du projet.

**Sympt√¥mes :**
- Commande `claude plugin uninstall supabase-toolkit` retournait "already uninstalled"
- MAIS le plugin √©tait toujours pr√©sent dans `installed_plugins.json`
- DONC ses 3 serveurs MCP se chargeaient quand m√™me
- Les 7 serveurs du `.mcp.json` n'√©taient jamais charg√©s

**Solution appliqu√©e :**
- √âdition manuelle de `/home/aclef/.claude/plugins/installed_plugins.json`
- Suppression des lignes 4-11 (entr√©e supabase-toolkit)
- Red√©marrage Claude Code requis pour v√©rifier

### Points cl√©s √† retenir
- **Plugin vs .mcp.json** : Les plugins install√©s globalement prennent la priorit√© sur .mcp.json
- **Bug d√©sinstallation** : La commande `claude plugin uninstall` peut √©chouer silencieusement
- **Fichier de r√©f√©rence** : `/home/aclef/.claude/plugins/installed_plugins.json` contient la vraie liste
- **Commande /npinstall** : Ne devrait PAS installer le plugin supabase-toolkit, seulement copier .mcp.json
- **Format chemin WSL** : Toujours utiliser `/mnt/c/...` et non `C:\...`

### Serveurs MCP attendus (apr√®s red√©marrage)
1. **supabase** - Toolkit Supabase (projet: mkbchdhbgdynxwfhpxbw)
2. **github** - Int√©gration GitHub
3. **sequential-thinking** - Raisonnement s√©quentiel
4. **deepwiki** - Documentation technique (HTTP)
5. **serena** - Assistant de recherche (uvx)
6. **memory** - M√©moire de session
7. **memory-bank** - M√©moire persistante (`/mnt/c/Projet ACLEF/.memory-bank`)

### Configuration .mcp.json
```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": ["-y", "@supabase/mcp-server-supabase@latest", "--project-ref=mkbchdhbgdynxwfhpxbw"],
      "env": {"SUPABASE_ACCESS_TOKEN": "sbp_..."}
    },
    "github": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-github"],
      "env": {"GITHUB_PERSONAL_ACCESS_TOKEN": "github_pat_..."}
    },
    "sequential-thinking": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-sequential-thinking"]
    },
    "deepwiki": {
      "url": "https://mcp.deepwiki.com/mcp",
      "transport": "http"
    },
    "serena": {
      "command": "uvx",
      "args": ["--from", "git+https://github.com/oraios/serena", "serena", "start-mcp-server"]
    },
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    },
    "memory-bank": {
      "command": "npx",
      "args": ["-y", "@allpepper/memory-bank-mcp@latest"],
      "env": {"MEMORY_BANK_ROOT": "/mnt/c/Projet ACLEF/.memory-bank"}
    }
  }
}
```

### Notes pour la prochaine session
- **Action imm√©diate** : Red√©marrer Claude Code dans "New Project" et v√©rifier que les 7 serveurs se chargent
- **Si succ√®s** : Mettre √† jour `/npinstall` pour NE PAS installer le plugin supabase-toolkit
- **Si √©chec** : Envisager configuration manuelle des serveurs MCP via Settings UI
- **Alternative** : Utiliser uniquement .mcp.json et supprimer toute r√©f√©rence au plugin
- **Documentation** : Le fichier .mcp.json du projet EST vu par Claude Code mais peut √™tre masqu√© par les plugins globaux

### Workflow utilis√©
1. `/regles` - Rappel des r√®gles
2. `/npinstall /mnt/c/Projet ACLEF/PT3` - Installation template
3. D√©tection probl√®me MCP (seulement 3 serveurs au lieu de 7)
4. Investigation : lecture installed_plugins.json
5. √âdition manuelle pour supprimer le plugin
6. Sauvegarde DEV.md avant test final

---

## [2025-11-09 18:55] - üíæ SAUVEGARDE: Installation template New Project + Configuration MCP & Context Monitor

‚ö†Ô∏è **Sauvegarde de routine apr√®s travail termin√©**

### Contexte
Session compl√®te d'installation et configuration du template New Project. Installation test r√©ussie dans "Projet test" et mise √† jour du template GitHub avec nouvelles fonctionnalit√©s.

### Fichiers modifi√©s

**Template New Project (GitHub):**
- `.mcp.json` - Ajout configuration 7 serveurs MCP (Supabase, GitHub, Sequential-thinking, DeepWiki, Serena, Memory, Memory-Bank)
- `templates/.gitignore.template` - Ajout exclusion `.mcp.json` (protection tokens sensibles)
- `.claude/scripts/context-monitor.py` - Script Python de monitoring contexte en temps r√©el
- `.claude/settings.local.json` - Configuration statusLine pour context-monitor (local, non commit√©)

**Projet test (/mnt/c/Projet ACLEF/Projet test):**
- Structure compl√®te install√©e via `/npinstall`
- Configuration `.claude/` (39 agents, 16 commandes)
- Fichiers `CLAUDE.md`, `R√®gles.md`, `.gitignore`
- Structure `DEV/` avec journal horodat√©
- Configuration `.mcp.json` avec serveurs MCP
- Script `context-monitor.py` install√©

### Travail en cours
- ‚úÖ Ex√©cution `/npinstall` pour "Projet test"
- ‚úÖ D√©tection absence `.mcp.json` dans template
- ‚úÖ Copie `.mcp.json` depuis projet p√©dagogie vers template
- ‚úÖ Mise √† jour `.gitignore` pour exclure `.mcp.json`
- ‚úÖ Installation `statusline/context-monitor` dans template ET Projet test
- ‚úÖ Commit et push vers GitHub (2 commits)
- ‚úÖ Sauvegarde dans DEV.md

### Points cl√©s √† retenir
- **Commande `/npinstall`** : Installe uniquement la configuration Claude (pas l'architecture projet)
- **Format chemin WSL** : Utiliser `/mnt/c/...` et non `C:\...`
- **Configuration MCP** : 7 serveurs install√©s (tokens sensibles prot√©g√©s par gitignore)
- **Context Monitor** : Affiche barres progression, alertes color√©es, analytics session dans statusline
- **Pattern utilis√©** : Template r√©utilisable pour standardiser configuration sur tous les projets
- **S√©curit√©** : `.mcp.json` exclu du git via `.gitignore` (contient tokens Supabase et GitHub)

### Serveurs MCP configur√©s
1. **supabase** - Toolkit Supabase (projet: mkbchdhbgdynxwfhpxbw)
2. **github** - Int√©gration GitHub
3. **sequential-thinking** - Raisonnement s√©quentiel
4. **deepwiki** - Documentation technique
5. **serena** - Assistant de recherche
6. **memory** - M√©moire de session
7. **memory-bank** - M√©moire persistante (`/mnt/c/Projet ACLEF/.memory-bank`)

### Commits GitHub
- **Commit `9e6541f`** : Feature: Ajout configuration MCP serveurs dans template
- **Commit `ee48312`** : Feature: Ajout context-monitor pour suivi utilisation tokens
- **D√©p√¥t** : https://github.com/Allakabeth/New-project.git
- **Branche** : main

### Code/Configuration importante

**Configuration statusLine (settings.local.json):**
```json
{
  "statusLine": {
    "type": "command",
    "command": "python3 .claude/scripts/context-monitor.py"
  }
}
```

**Exclusion gitignore:**
```gitignore
# MCP Configuration (contains sensitive tokens)
.mcp.json
```

### Notes pour la prochaine session
- Template New Project maintenant complet avec MCP + Context Monitor
- Tous les futurs projets cr√©√©s avec `/npinstall` auront automatiquement :
  - Configuration MCP (7 serveurs)
  - Context Monitor dans statusline
  - Protection des tokens sensibles
- Prochaine √©tape : Tester `/npinit` pour g√©n√©rer architecture projet via questionnaire
- Journal DEV horodat√© fonctionne parfaitement

### Workflow utilis√©
1. `/regles` - Rappel des r√®gles de travail
2. `/npinstall` - Installation template dans nouveau projet
3. D√©tection probl√®me ‚Üí Question ‚Üí Validation ‚Üí Ex√©cution
4. Installation MCP (copie + gitignore)
5. Installation context-monitor (npx claude-code-templates)
6. `/push` - Commit + Push GitHub
7. `/save` - Sauvegarde DEV.md

---

## [2025-11-09 15:35] - üíæ SAUVEGARDE: Session de configuration initiale

‚ö†Ô∏è **Sauvegarde de routine - aucun travail en cours**

### Contexte
Session tr√®s courte - uniquement push de la r√©organisation documentation. Aucune modification de code.

### Fichiers modifi√©s
- Aucun fichier de code modifi√© dans cette session

### Travail en cours
- ‚úÖ Push de la r√©organisation documentation (commit `a472197`)
- ‚úÖ Mise √† jour journal DEV
- ‚úÖ V√©rification commandes /push et /save

### Points cl√©s √† retenir
- **Commande /push** : Fonctionne correctement pour git commit + push + mise √† jour DEV.md
- **Commande /save** : Test√©e, permet sauvegarde sans commit
- **Nouveau workflow** : Fichiers DEV horodat√©s cr√©√©s automatiquement au d√©but de chaque session

### Notes pour la prochaine session
- Session de configuration termin√©e
- Pr√™t pour du vrai travail de d√©veloppement
- Tous les rituels en place (DEV.md, r√®gles, commandes)

---

## [2025-11-09 15:30] - Docs: R√©organisation structure documentation

### Fichiers modifi√©s
- `CLAUDE2.md` - Supprim√© (obsol√®te)
- `DEV.md` - Supprim√© (remplac√© par structure horodat√©e)
- `DEV/DEV_09112025_15_30.md` - Cr√©√© (nouveau journal horodat√©)
- `DEV/DEV.md` - Cr√©√© (archive des anciennes entr√©es)
- `CLAUDE.md` - Mis √† jour (clarifications mineures)

### Points cl√©s √† retenir
- **Structure DEV/** : Nouveau syst√®me de journaux horodat√©s pour suivre les sessions
- **Pattern utilis√©** : Un fichier par session (format `DEV_JJMMAAAA_HH_MM.md`)
- **Objectif** : Meilleure tra√ßabilit√© chronologique des modifications

### Commit
- SHA: `a472197`
- Message: "Docs: R√©organisation structure documentation"
- Pouss√© vers: `origin/main`

---
