# DEV - Session du 10/11/2025

## [2025-11-10 14:30] - üíæ SAUVEGARDE: Refonte UI Module Lire + Mes textes r√©f√©rences

‚ö†Ô∏è **Sauvegarde avant compactage de conversation**

### Contexte
Conversation proche de la limite de tokens - sauvegarde des modifications non push√©es.
Session de refonte UI pour am√©liorer l'ergonomie mobile et desktop du module Lire.

### Fichiers modifi√©s

#### 1. `/pages/lire/mes-textes-references.js`
- ‚úÖ Ic√¥ne üìö corrig√©e (color√©e au lieu de verte)
- ‚úÖ Ajout ic√¥nes navigation (üìñ retour Lire + üè† accueil)
- ‚úÖ Suppression bouton retour en bas
- ‚úÖ Remplacement ic√¥ne üìñ ‚Üí üìö dans bouton "Voir mes textes"

#### 2. `/pages/lire.js` (Module Lire principal)
- ‚úÖ Ic√¥ne üìñ corrig√©e (color√©e au lieu de verte)
- ‚úÖ Ic√¥ne üè† ajout√©e √† droite du titre (mobile: 24px, desktop: 32px)
- ‚úÖ Suppression texte "Choisissez une activit√© de lecture :"
- ‚úÖ Suppression bouton "üìä Statistiques"
- ‚úÖ Grille uniformis√©e : **3 colonnes √©gales sur PC** (tous boutons m√™me taille)
- ‚úÖ R√©organisation boutons dans ordre demand√©

**Nouvel ordre des activit√©s (grille 3√ó4) :**
```
Ligne 1: Mes textes r√©f√©rences | O√π est-ce ? | Qu'est-ce ?
Ligne 2: Remettre dans l'ordre | Dict√©es recherche | Reconnaitre les mots
Ligne 3: Syllabe-mot | Mes Syllabes-Mots | Segmentation des Syllabes
Ligne 4: Mes syllabes | Je joue avec mes syllabes | Lectures d√©couverte
```

**Optimisations mobile (‚â§768px) :**
- Ic√¥ne üè† plac√©e √† droite du titre (m√™me ligne)
- Taille ic√¥ne r√©duite : 24px (au lieu de 32px)
- Boutons compacts : 55px hauteur (au lieu de 80px)
- Padding r√©duit : 10px 8px
- Police : 12px (au lieu de 15px)
- Gap : 8px (au lieu de 15px)
- Alignement : flex-start (page commence en haut)
- Infos utilisateur r√©duites : 10px font, 8px padding

**Optimisations desktop (>768px) :**
- Grille fixe : `repeat(3, 1fr)` (3 colonnes √©gales)
- Tous les boutons : `minHeight: 80px`
- Utilisation de `display: flex` + `alignItems/justifyContent: center`
- Aucun bouton plus grand qu'un autre

### Travail en cours
- ‚úÖ Refonte UI Module Lire termin√©e
- ‚úÖ Refonte UI Mes textes r√©f√©rences termin√©e
- ‚úÖ Optimisation mobile pour affichage sans scroll
- ‚è≥ Tests en situation r√©elle √† faire
- ‚è≥ Commit Git √† faire

### Points cl√©s √† retenir

**1. D√©tection mobile dans lire.js :**
```javascript
const isMobile = typeof window !== 'undefined' && window.innerWidth <= 768
```
‚ö†Ô∏è Variable statique (pas r√©active au resize)

**2. Pattern grille responsive :**
```javascript
gridTemplateColumns: isMobile
    ? 'repeat(auto-fit, minmax(180px, 1fr))' // Mobile
    : 'repeat(3, 1fr)',                       // Desktop
gap: isMobile ? '8px' : '15px',
```

**3. Pattern boutons uniformes :**
```javascript
minHeight: isMobile ? '55px' : '80px',
padding: isMobile ? '10px 8px' : 'clamp(15px, 4vw, 20px) clamp(10px, 3vw, 15px)',
fontSize: isMobile ? '12px' : 'clamp(13px, 3vw, 15px)',
display: 'flex',
alignItems: 'center',
justifyContent: 'center'
```

**4. Ic√¥nes color√©es (pas affect√©es par d√©grad√©) :**
```javascript
<h1>
    <span style={{ marginRight: '8px' }}>üìñ</span>
    <span style={{
        background: 'linear-gradient(...)',
        WebkitBackgroundClip: 'text',
        WebkitTextFillColor: 'transparent'
    }}>
        Module Lire
    </span>
</h1>
```

**5. Titre + ic√¥ne align√©s (mobile) :**
```javascript
<div style={{
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center'
}}>
    <h1>üìñ Module Lire</h1>
    <button>üè†</button>
</div>
```

### Code important

**Modifications appliqu√©es avec `replace_all` pour uniformiser les 12 boutons :**
```javascript
// AVANT (tous les boutons)
padding: 'clamp(15px, 4vw, 20px) clamp(10px, 3vw, 15px)',
fontSize: 'clamp(13px, 3vw, 15px)',
minHeight: '80px',

// APR√àS (tous les boutons)
padding: isMobile ? '10px 8px' : 'clamp(15px, 4vw, 20px) clamp(10px, 3vw, 15px)',
fontSize: isMobile ? '12px' : 'clamp(13px, 3vw, 15px)',
minHeight: isMobile ? '55px' : '80px',
```

### Probl√®mes rencontr√©s

**1. Boutons de tailles diff√©rentes sur PC**
- **Cause** : `gridTemplateColumns: repeat(auto-fit, minmax(180px, 1fr))`
- **Solution** : `gridTemplateColumns: repeat(3, 1fr)` sur desktop
- **R√©sultat** : Tous les boutons exactement la m√™me largeur

**2. Ic√¥nes üìö et üìñ en vert**
- **Cause** : `WebkitBackgroundClip: 'text'` appliqu√© √† tout le h1
- **Solution** : S√©parer ic√¥ne et texte dans 2 `<span>` diff√©rents
- **R√©sultat** : Ic√¥ne color√©e, texte avec d√©grad√© vert

**3. Tout ne rentre pas sur mobile sans scroll**
- **Solution multi-facette** :
  - R√©duction hauteur boutons : 80px ‚Üí 55px
  - R√©duction padding : 15px ‚Üí 10px
  - R√©duction gap : 15px ‚Üí 8px
  - Suppression message "Choisissez une activit√©"
  - Alignement haut de page : `alignItems: flex-start`
  - Ic√¥ne maison dans titre (√©conomise une ligne)

### Notes pour la prochaine session

**√Ä TESTER :**
- [ ] Affichage mobile sur iPhone SE (320px)
- [ ] Grille 3√ó4 sur PC (tous boutons m√™me taille ?)
- [ ] Navigation ic√¥nes üìñ et üè† fonctionnelles
- [ ] Tout tient sans scroll sur mobile

**√Ä COMMITER :**
- `pages/lire.js` - Refonte UI + optimisations mobile
- `pages/lire/mes-textes-references.js` - Navigation + ic√¥nes

**Message commit sugg√©r√© :**
```
UI: Refonte Module Lire + optimisations mobile

- Grille 3√ó4 uniformis√©e sur PC (tous boutons m√™me taille)
- Optimisations mobile : boutons compacts (55px), page sans scroll
- Ic√¥nes navigation (üìñ üè†) ajout√©es
- R√©organisation ordre activit√©s
- Suppression Statistiques + texte "Choisissez une activit√©"
- Ic√¥nes color√©es (üìö üìñ) corrig√©es
```

**O√π on en √©tait :**
- Session termin√©e sur l'optimisation mobile
- Code fonctionnel mais non test√©
- Pr√™t pour commit

---

## D√©but de session

- Date : 10/11/2025
- Heure : 09:18
- Contexte : Am√©lioration UI Mode D√©fi - Affichage mots sur mobile
- Projet : ACLEF P√©dagogique

---

## [2025-11-10 09:18] - UI: Grille 4 colonnes pour mots disponibles sur mobile (Mode D√©fi)

### Contexte
L'apprenant signale que l'affichage des mots disponibles sur mobile prend trop de place verticalement avec seulement 2 colonnes, obligeant √† scroller excessivement. Objectif : optimiser l'espace √©cran mobile.

### Fichier modifi√©
- `pages/lire/construis-phrases/defi.js` - Grille responsive pour mots disponibles

### Modifications effectu√©es

**Probl√®me :**
- Grille fixe 2 colonnes sur tous les √©crans
- Trop de scroll vertical sur mobile quand beaucoup de mots (phrase + 8 intrus = ~15 mots)

**Solution :**
- Grille responsive : **4 colonnes sur mobile**, 2 colonnes sur desktop
- Gap r√©duit √† 8px sur mobile (au lieu de 10px) pour que les 4 colonnes rentrent bien

**Code modifi√© (lignes 762-766) :**

**AVANT :**
```javascript
<div style={{
    display: 'grid',
    gridTemplateColumns: 'repeat(2, 1fr)',
    gap: isMobile ? '10px' : '15px'
}}>
```

**APR√àS :**
```javascript
<div style={{
    display: 'grid',
    gridTemplateColumns: isMobile ? 'repeat(4, 1fr)' : 'repeat(2, 1fr)',
    gap: isMobile ? '8px' : '15px'
}}>
```

### D√©cisions architecturales

**Pourquoi 4 colonnes et pas 3 ?**
- Demande explicite de l'utilisateur
- Avec 15 mots moyens, 4 colonnes = ~4 lignes au lieu de 8 lignes
- R√©duction scroll de 50%

**Pourquoi gap 8px au lieu de 10px ?**
- Sur mobile, chaque pixel compte
- 4 colonnes + gap 10px risquait d√©bordement sur petits √©crans
- 8px garde bonne lisibilit√© tout en optimisant l'espace

**Variable `isMobile` d√©j√† pr√©sente :**
```javascript
const isMobile = typeof window !== 'undefined' && window.innerWidth <= 768
```
‚ö†Ô∏è **ATTENTION** : Cette variable est statique (calcul√©e au montage), pas r√©active. Si on veut du vrai responsive avec resize, il faudrait utiliser un state + listener.

### Pattern r√©utilisable

**Grille responsive mobile-first :**
```javascript
gridTemplateColumns: isMobile
    ? 'repeat(4, 1fr)'  // Plus de colonnes sur mobile
    : 'repeat(2, 1fr)', // Moins de colonnes sur desktop
gap: isMobile ? '8px' : '15px' // Gap r√©duit sur mobile
```

Ce pattern inverse la logique habituelle (desktop = plus d'espace). Ici, on privil√©gie la densit√© sur mobile pour r√©duire le scroll vertical.

### Points d'attention

**√Ä TESTER :**
- Sur iPhone SE (320px) : les 4 colonnes passent-elles bien ?
- Sur tablette portrait (768px) : d√©tection mobile correcte ?
- Taille texte boutons : lisible en 4 colonnes ?

**Coh√©rence avec autres modes :**
- `tranquille.js` : utilise aussi grille 2 colonnes
- `difficile.js` : utilise aussi grille 2 colonnes
- **Question** : Faut-il appliquer le m√™me pattern 4 colonnes mobile sur ces modes ?

### √âtat actuel
- ‚úÖ Modification appliqu√©e sur `defi.js`
- ‚ö†Ô∏è **NON TEST√â** en situation r√©elle sur mobile
- ‚ö†Ô∏è **NON COMMIT√â** sur Git
- ‚ùì D√©cision en attente : appliquer aux modes `tranquille.js` et `difficile.js` ?

### Notes importantes

**Contexte global :**
- Session pr√©c√©dente (09/11) : travail sur g√©n√©ration phrases IA (probl√®me quotas Gemini/Groq)
- Fallback JavaScript cr√©√© mais jug√© "foireux" par l'utilisateur
- **Strat√©gie actuelle** : finir les pages UI d'abord, r√©gler g√©n√©ration IA apr√®s

**Workflow session :**
1. `/regles` - Rappel des r√®gles (pas de modification sans permission)
2. Lecture du fichier DEV le plus r√©cent
3. Demande utilisateur : colonnes sur mobile
4. Proposition avec code exact ‚Üí Validation ‚Üí Ex√©cution
5. `/dev` - Documentation session

---

## [2025-11-10 10:12] - Feature: Refonte Mode Difficile + Reconnaissance vocale par similarit√©

### Contexte
Refonte compl√®te du mode difficile avec nouvelle UI coh√©rente et am√©lioration majeure de la reconnaissance vocale. Le syst√®me de comparaison mot-par-mot strict causait trop de faux n√©gatifs avec Whisper (variations grammaticales, d√©coupage de mots compos√©s, liaisons).

### Fichier modifi√©
- `pages/lire/construis-phrases/difficile.js` - Refonte UI + Algorithme reconnaissance vocale

### Modifications effectu√©es

**1. Refonte UI Mode Difficile**

**Probl√®me :**
- Fond rouge d√©grad√© agressif
- Layout avec cadre blanc encombrant
- Pas coh√©rent avec les autres modes (Tranquille, D√©fi)

**Solution :**
- Couleur orange (#f97316) au lieu de rouge
- Fond blanc sans cadre
- Structure 3 lignes comme Mode D√©fi :
  - Ligne 1 : üî• Mode Difficile
  - Ligne 2 : Phrase X/Y (gauche) + Score (droite)
  - Ligne 3 : Ic√¥nes navigation (‚Üê üëÅÔ∏è üìñ üè†)

**2. Feedback visuel mot par mot**

**Avant :**
- Phrase enti√®re dans un cadre
- Message "‚ùå Essayez encore !" (n√©gatif)
- Pas d'indication sur o√π est l'erreur

**Apr√®s :**
- Mots s√©par√©s avec cadres individuels
- **Cadre VERT** (#10b981) si reconnaissance correcte
- **Cadre ROUGE** (#ef4444) si reconnaissance incorrecte
- Plus de message n√©gatif

**3. Algorithme de reconnaissance vocale - CHANGEMENT MAJEUR**

**Probl√®me identifi√© :**
Comparaison mot-par-mot stricte causait des faux n√©gatifs :

```
Logs r√©els :
Attendu: ["je", "suis", "avec", "renesm√©"]
Transcrit: ["je", "suis", "avec", "ren√©", "smet"]
‚Üí REJET√â (Whisper d√©coupe le pr√©nom en 2 mots)

Attendu: ["√†", "royan", "avec", "mes", "enfants"]
Transcrit: ["arroyant", "avec", "mes", "enfants"]
‚Üí REJET√â (Whisper comprend la liaison)

Attendu: ["je", "suis", "partie"]
Transcrit: ["je", "suis", "parti"]
‚Üí REJET√â (m√™me son, orthographe diff√©rente)
```

**Solution : Algorithme de similarit√© globale (Levenshtein)**

Au lieu de comparer mot par mot, on compare **la phrase ENTI√àRE** :

1. **Normalisation ultra-compl√®te :**
   ```javascript
   const normaliser = (text) => {
       return text
           .toLowerCase()
           .replace(/[.,;:!?'"¬´¬ª\-‚Äî\s]/g, '')  // Enl√®ve TOUT (espaces inclus)
           .normalize('NFD')
           .replace(/[\u0300-\u036f]/g, '')    // Enl√®ve accents
   }
   ```

2. **Calcul distance de Levenshtein :**
   - Mesure le nombre de modifications n√©cessaires pour transformer une cha√Æne en une autre
   - Convertit en pourcentage de similarit√©

3. **Seuil de validation : 80%**
   - Si similarit√© ‚â• 80% ‚Üí ‚úÖ CORRECT (tous mots en vert)
   - Si similarit√© < 80% ‚Üí ‚ùå INCORRECT (tous mots en rouge)

**Exemples de r√©sultats :**

```javascript
// ‚úÖ Accept√© (80%+)
"renesm√©" vs "renesmet" ‚Üí 95% similaire
"aroyan" vs "arroyant" ‚Üí 85% similaire
"partie" vs "parti" ‚Üí 95% similaire
"jesuispartiavecne" vs "jesuispartieavecmes" ‚Üí 84% similaire

// ‚ùå Rejet√© (<80%)
"renesmeadoraitjouer" vs "lesmithdoitetrevege" ‚Üí 26% similaire
```

### Code important

**Fonction de calcul de similarit√© :**
```javascript
const levenshtein = (s1, s2) => {
    const matrix = []

    // Initialisation matrice
    for (let i = 0; i <= s2.length; i++) {
        matrix[i] = [i]
    }

    for (let j = 0; j <= s1.length; j++) {
        matrix[0][j] = j
    }

    // Calcul distances
    for (let i = 1; i <= s2.length; i++) {
        for (let j = 1; j <= s1.length; j++) {
            if (s2.charAt(i - 1) === s1.charAt(j - 1)) {
                matrix[i][j] = matrix[i - 1][j - 1]
            } else {
                matrix[i][j] = Math.min(
                    matrix[i - 1][j - 1] + 1,  // substitution
                    matrix[i][j - 1] + 1,      // insertion
                    matrix[i - 1][j] + 1        // suppression
                )
            }
        }
    }

    return matrix[s2.length][s1.length]
}

const calculerSimilarite = (s1, s2) => {
    const longueurMax = Math.max(s1.length, s2.length)
    if (longueurMax === 0) return 100

    const distance = levenshtein(s1, s2)
    return Math.round(((longueurMax - distance) / longueurMax) * 100)
}
```

### D√©cisions architecturales

**Pourquoi comparaison globale et pas mot-par-mot ?**
1. Whisper d√©coupe les mots diff√©remment (noms propres, liaisons)
2. Les variations grammaticales sont phon√©tiquement identiques
3. L'objectif est de valider la **prononciation**, pas l'**orthographe**

**Pourquoi seuil 80% ?**
- 80% : Tol√©rant pour Whisper mais assez strict pour d√©tecter vraies erreurs
- 70% : Trop permissif (accepterait phrases trop diff√©rentes)
- 90% : Trop strict (rejetterait trop de bonnes prononciations)

**Limitation connue :**
Les pr√©noms rares/invent√©s (ex: "Renesm√©" de Twilight) ne sont pas reconnus par Whisper. D√©cision: **Garder 80%** et √©viter pr√©noms rares dans les textes.

### Avantages de la solution

**Pour l'apprenant :**
- ‚úÖ Moins de frustration (faux n√©gatifs r√©duits)
- ‚úÖ Feedback visuel clair (mots verts/rouges)
- ‚úÖ Validation de la prononciation r√©elle (pas orthographe)

**Pour le syst√®me :**
- ‚úÖ Robuste face aux variations Whisper
- ‚úÖ Algorithme standard (Levenshtein)
- ‚úÖ Logs de similarit√© pour debugging

### √âtat actuel
- ‚úÖ UI refonte termin√©e (orange, 3 lignes, sans cadre)
- ‚úÖ Feedback visuel mots verts/rouges op√©rationnel
- ‚úÖ Algorithme Levenshtein impl√©ment√© (seuil 80%)
- ‚úÖ Test√© manuellement avec logs console
- ‚úÖ Commit√© et push√© sur Git (`0233518`)

### Commit
- SHA: `0233518`
- Message: "Feature: Refonte Mode Difficile + Reconnaissance vocale par similarit√©"
- Pouss√© vers: `origin/main`
- Lignes modifi√©es : +218 -82

---
